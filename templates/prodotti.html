<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offerte Amazon - Prezzo AI Tracker</title>
    <meta name="description" content="Scopri le migliori offerte Amazon aggiornate in tempo reale con Prezzo AI Tracker.">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f9f9f9; }
        header { background: #0073e6; color: white; padding: 20px; font-size: 24px; text-align: center; }
        .container { padding: 20px; max-width: 1200px; margin: auto; }
        .filters { display: flex; justify-content: space-between; margin: 15px 0; }
        .product-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
        .product { border: 1px solid #ddd; padding: 15px; width: 250px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); text-align: center; }
        .product img { width: 100%; height: auto; border-radius: 8px; }
        .button { background: #ff9900; color: white; padding: 10px; text-decoration: none; display: block; border-radius: 5px; transition: 0.3s; }
        .button:hover { background: #e68a00; transform: scale(1.05); }
    </style>
</head>
<body>
    <header>Offerte Amazon - Prezzo AI Tracker</header>
    
    <div class="container">
        <input type="text" id="search" class="search-bar" placeholder="üîç Cerca un prodotto...">
        
        <div class="filters">
            <select id="categoryFilter">
                <option value="all">Tutte le categorie</option>
            </select>
            <select id="discountFilter">
                <option value="all">Tutti gli sconti</option>
                <option value="10">Almeno 10%</option>
                <option value="20">Almeno 20%</option>
                <option value="30">Almeno 30%</option>
            </select>
            <select id="ratingFilter">
                <option value="all">Tutte le valutazioni</option>
                <option value="4">4+ ‚≠ê</option>
                <option value="4.5">4.5+ ‚≠ê</option>
                <option value="5">5 ‚≠ê</option>
            </select>
        </div>

        <div id="product-list" class="product-list">Caricamento prodotti...</div>
    </div>

    <script>
        let productsData = [];

        async function fetchProducts() {
            try {
                let response = await fetch("http://127.0.0.1:5001/api/prodotti");
                productsData = await response.json();
                updateCategoryFilter();
                displayProducts(productsData);
            } catch (error) {
                document.getElementById("product-list").innerHTML = "Errore nel caricamento prodotti.";
            }
        }

        async function fetchCategories() {
            try {
                let response = await fetch("http://127.0.0.1:5001/api/categorie");
                let categories = await response.json();
                updateCategoryFilter(categories);
            } catch (error) {
                console.error("Errore nel caricamento delle categorie", error);
            }
        }

        function updateCategoryFilter(categories = []) {
            let categoryFilter = document.getElementById("categoryFilter");
            categoryFilter.innerHTML = '<option value="all">Tutte le categorie</option>';
            categories.forEach(category => {
                let option = document.createElement("option");
                option.value = category;
                option.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                categoryFilter.appendChild(option);
            });
        }

        function displayProducts(products) {
            let productList = document.getElementById("product-list");
            productList.innerHTML = "";
            products.forEach(product => {
                let productDiv = document.createElement("div");
                productDiv.classList.add("product");

                let imageUrl = product.image_url && product.image_url !== "N/A" ? product.image_url : "https://via.placeholder.com/250";

                productDiv.innerHTML = `
                    <img src="${imageUrl}" alt="${product.name}">
                    <h3>${product.name || "Prodotto senza nome"}</h3>
                    <p>üí∞ Prezzo: <strong>‚Ç¨${product.price || "Non disponibile"}</strong></p>
                    <p>üîª Sconto: <strong>${product.discount ? product.discount + "%" : "Nessuno"}</strong></p>
                    <p>‚≠ê Rating: <strong>${product.rating || "N/D"}</strong></p>
                    <p>üó£Ô∏è Recensioni: <strong>${product.reviews || "Nessuna recensione"}</strong></p>
                    <a href="${product.affiliate_link}" class="button" target="_blank">üîó Acquista su Amazon</a>
                `;
                productList.appendChild(productDiv);
            });
        }

        document.getElementById("categoryFilter").addEventListener("change", function() {
            let selectedCategory = this.value;
            let filteredProducts = selectedCategory === "all" ? productsData : productsData.filter(p => p.category === selectedCategory);
            displayProducts(filteredProducts);
        });

        fetchProducts();
        fetchCategories();
    </script>
</body>
</html>
